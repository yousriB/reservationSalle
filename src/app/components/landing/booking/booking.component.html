<section class="py-12 bg-gray-50">
  <app-navbar></app-navbar>
  <div class="mx-auto max-w-5xl px-4 pt-8">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">Book Your Event</h2>
      <p class="text-lg text-gray-600">
        Complete the form below to reserve your perfect event
      </p>
    </div>

    <div class="bg-white p-8 rounded-xl shadow-lg">
      <form
        (ngSubmit)="submitForm()"
        class="grid grid-cols-1 md:grid-cols-2 gap-6"
      >
        <!-- Basic Information -->
        <div class="md:col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Event Details
          </h3>
        </div>

        <div class="mb-4">
          <label
            for="title"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Event Title*</label
          >
          <input
            id="title"
            [(ngModel)]="bookingForm.title"
            name="title"
            type="text"
            required
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="e.g., John's Birthday Party"
            #titleInput="ngModel"
          />
          <div
            *ngIf="
              titleInput.invalid && (titleInput.dirty || titleInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please provide an event title
          </div>
        </div>

        <div class="mb-4">
          <label
            for="typeEvent"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Event Type*</label
          >
          <select
            id="typeEvent"
            [(ngModel)]="bookingForm.typeEvent"
            name="typeEvent"
            required
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            #typeEventInput="ngModel"
          >
            <option value="" disabled selected>Select event type</option>
            <option *ngFor="let type of eventTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <div
            *ngIf="
              typeEventInput.invalid &&
              (typeEventInput.dirty || typeEventInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please select an event type
          </div>
        </div>

        <div class="mb-4">
          <label for="date" class="block text-sm font-medium text-gray-700 mb-1"
            >Date*</label
          >
          <input
            id="date"
            [(ngModel)]="bookingForm.date"
            name="date"
            type="date"
            required
            [min]="minDate"
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            #dateInput="ngModel"
          />
          <div
            *ngIf="dateInput.invalid && (dateInput.dirty || dateInput.touched)"
            class="text-red-500 text-sm mt-1"
          >
            Please select a date
          </div>
        </div>

        <div class="mb-4">
          <label
            for="numberOfSeats"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Number of Guests*</label
          >
          <input
            id="numberOfSeats"
            [(ngModel)]="bookingForm.numberOfSeats"
            name="numberOfSeats"
            type="number"
            min="1"
            max="200"
            required
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="50"
            #numberOfSeatsInput="ngModel"
          />
          <div
            *ngIf="
              numberOfSeatsInput.invalid &&
              (numberOfSeatsInput.dirty || numberOfSeatsInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please enter number of guests
          </div>
        </div>

        <!-- Location Selection -->
        <div class="col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Venue Selection
          </h3>
          <p class="text-sm text-gray-500 mb-4">
            Choose your preferred event location
          </p>

          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div
              *ngFor="let location of locationOptions"
              class="border-2 rounded-xl p-3 cursor-pointer transition-all hover:shadow-md"
              [class.border-blue-500]="bookingForm.local === location.value"
              [class.border-gray-200]="bookingForm.local !== location.value"
              (click)="bookingForm.local = location.value"
            >
              <img
                [src]="location.image"
                [alt]="location.label"
                class="w-full h-32 object-cover rounded-lg mb-2"
              />
              <h4 class="font-medium text-center">{{ location.label }}</h4>
              <p class="text-xs text-gray-500 text-center">
                {{ location.price }} TND
              </p>
            </div>
          </div>
          <div
            *ngIf="
              !bookingForm.local && (localInput.dirty || localInput.touched)
            "
            class="text-red-500 text-sm mt-2"
          >
            Please select a location
          </div>
          <input
            type="hidden"
            [(ngModel)]="bookingForm.local"
            name="local"
            #localInput="ngModel"
          />
        </div>

        <!-- Food -->
        <div class="col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Catering
          </h3>
        </div>

        <div class="mb-4 col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Food Style*</label
          >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div
              *ngFor="let food of foodOptions"
              class="border rounded-lg p-2 cursor-pointer transition-all hover:shadow-sm"
              [class.border-blue-500]="bookingForm.foodType.includes(food.value)"
              [class.border-gray-200]="!bookingForm.foodType.includes(food.value)"
              (click)="toggleFoodType(food.value)"
            >
              <img
                [src]="food.image"
                [alt]="food.label"
                class="w-full h-32 object-cover rounded-md mb-1"
              />
              <p class="text-xs text-center">{{ food.label }} - {{food.price}} TND</p>
            </div>
          </div>
          <div
            *ngIf="
              !bookingForm.entertainment.length &&
              (entertainmentInput.dirty || entertainmentInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please select at least one entertainment theme.
          </div>
          <input
            type="hidden"
            [(ngModel)]="bookingForm.entertainment"
            name="entertainment"
            #entertainmentInput="ngModel"
          />
        </div>
        <!-- Decoration -->
        <div class="col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Decoration
          </h3>
        </div>
        <div class="mb-4 col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Decoration Theme*</label
          >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div
              *ngFor="let decor of decorationOptions"
              class="border rounded-lg p-2 cursor-pointer transition-all hover:shadow-sm"
              [class.border-blue-500]="bookingForm.decorationType.includes(decor.value)"
              [class.border-gray-200]="!bookingForm.decorationType.includes(decor.value)"
              (click)="toggleDecorationType(decor.value)"
            >
              <img
                [src]="decor.image"
                [alt]="decor.label"
                class="w-full h-32 object-cover rounded-md mb-1"
              />
              <p class="text-xs text-center">{{ decor.label }} - {{decor.price}} TND</p>
            </div>
          </div>
          <div
            *ngIf="
              !bookingForm.decorationType.length &&
              (decorationTypeInput.dirty || decorationTypeInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please select at least one decoration theme
          </div>
          <input
            type="hidden"
            [(ngModel)]="bookingForm.decorationType"
            name="decorationType"
            #decorationTypeInput="ngModel"
          />
        </div>

        <!-- Entertainment -->
        <div class="col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Entertainment
          </h3>
        </div>
        <div class="mb-4 col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Entertainment Theme*</label
          >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div
              *ngFor="let entertainment of entertainmentOptions"
              class="border rounded-lg p-2 cursor-pointer transition-all hover:shadow-sm"
              [class.border-blue-500]="bookingForm.entertainment.includes(entertainment.value)"
              [class.border-gray-200]="!bookingForm.entertainment.includes(entertainment.value)"
              (click)="toggleEntertainment(entertainment.value)"
            >
              <img
                [src]="entertainment.image"
                [alt]="entertainment.label"
                class="w-full h-32 object-cover rounded-md mb-1"
              />
              <p class="text-xs text-center">{{ entertainment.label }} - {{entertainment.price}} TND</p>
            </div>
          </div>
          <div
            *ngIf="
              !bookingForm.entertainment.length &&
              (entertainmentInput.dirty || entertainmentInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please select at least one entertainment theme
          </div>
          <input
            type="hidden"
            [(ngModel)]="bookingForm.entertainment"
            name="entertainment"
            #entertainmentInput="ngModel"
          />
        </div>

        <!-- Others -->
        <div class="col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Others
          </h3>
        </div>
        <div class="mb-4 col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Other Options*</label
          >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div
              *ngFor="let other of otherOptions"
              class="border rounded-lg p-2 cursor-pointer transition-all hover:shadow-sm"
              [class.border-blue-500]="bookingForm.others.includes(other.value)"
              [class.border-gray-200]="!bookingForm.others.includes(other.value)"
              (click)="toggleOther(other.value)"
            >
              <img
                [src]="other.image"
                [alt]="other.label"
                class="w-full h-32 object-cover rounded-md mb-1"
              />
              <p class="text-xs text-center">{{ other.label }} - {{other.price}} TND</p>
            </div>
          </div>
          <div
            *ngIf="
              !bookingForm.others.length &&
              (otherInput.dirty || otherInput.touched)
            "
            class="text-red-500 text-sm mt-1"
          >
            Please select at least one other option
          </div>
          <input
            type="hidden"
            [(ngModel)]="bookingForm.others"
            name="others"
            #otherInput="ngModel"
          />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-3">Other Services</label>
          <div class="space-y-2">
            <label class="flex items-center space-x-2">
              <input type="checkbox" [(ngModel)]="bookingForm.transport" name="transport"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span class="text-sm text-gray-700">Transportation Service (+100 TND)</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="checkbox" [(ngModel)]="bookingForm.security" name="security"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span class="text-sm text-gray-700">Security Personnel (+100 TND)</span>
            </label>
          </div>
        </div>

        <div class="md:col-span-2">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Payment Information
          </h3>

          <div class="mb-4">
            <label for="paymentMethod" class="block text-sm font-medium text-gray-700 mb-1">Payment Method*</label>
            <select id="paymentMethod" [(ngModel)]="bookingForm.paymentMethod" name="paymentMethod" required
              class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              #paymentMethodInput="ngModel">
              <option value="" disabled selected>Select payment method</option>
              <option *ngFor="let method of paymentMethods" [value]="method.value">
                {{ method.label }}
              </option>
            </select>
            <div *ngIf="paymentMethodInput.invalid && (paymentMethodInput.dirty || paymentMethodInput.touched)"
              class="text-red-500 text-sm mt-1">
              Please select a payment method
            </div>
          </div>
        </div>

        <!-- Price Summary -->
        <div class="md:col-span-2 bg-gray-50 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            Price Summary
          </h3>

          <div class="space-y-3">
            <!-- Venue Price -->
            <div class="flex justify-between">
              <span class="text-gray-600">Venue Rental</span>
              <span class="font-medium">{{locationPriceTotal}} TND</span>
            </div>

            <!-- Food Price -->
            <div class="flex justify-between">
              <span class="text-gray-600">Food</span>
              <span class="font-medium">{{foodPriceTotal}} TND</span>
            </div>

            <!-- Decoration Price -->
            <div class="flex justify-between">
              <span class="text-gray-600">Decoration</span>
              <span class="font-medium">{{decorationPriceTotal}} TND</span>
            </div>

            <!-- Entertainment Price -->
            <div class="flex justify-between">
              <span class="text-gray-600">Entertainment</span>
              <span class="font-medium">{{entertainmentPriceTotal}} TND</span>
            </div>

            <!-- Additional Services -->
            <div class="flex justify-between" *ngIf="bookingForm.transport">
              <span class="text-gray-600">Transportation Service</span>
              <span class="font-medium">100 TND</span>
            </div>

            <div class="flex justify-between" *ngIf="bookingForm.security">
              <span class="text-gray-600">Security Personnel</span>
              <span class="font-medium">100 TND</span>
            </div>

            <!-- Total Price -->
            <div class="flex justify-between pt-4 border-t border-gray-200 mt-3">
              <span class="text-lg font-semibold">Total Price</span>
              <span class="text-lg font-bold text-blue-600">{{calculateTotalPrice()}} TND</span>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="md:col-span-2 flex justify-end pt-4">
          <button type="submit" [disabled]="!isFormValid()"
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300">
            Confirm Booking
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
